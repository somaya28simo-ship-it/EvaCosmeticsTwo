@model WebApplication1.Models.Product
@{
    ViewData["Title"] = Model.Name;
    Layout = "_Layout";
}

<style>
    /* === ✅ تعريف ألوان التطبيق الرئيسية === */
    :root {
        --app-pink: #e83e8c; /* اللون الوردي الأساسي */
        --app-pink-darker: #d1367d; /* لون أغمق للتأثيرات مثل hover */
    }

    /* === تصميم مخصص لتقييم النجوم === */
    .star-rating {
        color: #ffc107;
    }

    .rating-input .fa-star {
        cursor: pointer;
        font-size: 1.5rem;
        color: #e4e5e9;
    }

        .rating-input .fa-star.selected {
            color: #ffc107;
        }

    /* === CSS للمحاذاة العمودية === */
    .product-info-column {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .product-details-content {
        flex-grow: 1;
    }

    /* === ✅ تخصيص ألوان الأزرار وحقول الإدخال === */
    .btn-app-theme {
        background-color: var(--app-pink);
        border-color: var(--app-pink);
        color: #fff;
    }

        .btn-app-theme:hover {
            background-color: var(--app-pink-darker);
            border-color: var(--app-pink-darker);
            color: #fff;
        }

    .btn-outline-app-theme {
        color: var(--app-pink);
        border-color: var(--app-pink);
    }

        .btn-outline-app-theme:hover {
            background-color: var(--app-pink);
            border-color: var(--app-pink);
            color: #fff;
        }

    .form-control:focus {
        border-color: var(--app-pink);
        box-shadow: 0 0 0 0.25rem rgba(232, 62, 140, 0.25);
    }
</style>

<div class="container py-5">
    <!-- === قسم المنتج الرئيسي === -->
    <div class="row mb-5">
        <div class="col-md-6 text-center">
            <!-- ✅ التعديل الأول هنا -->
            <img src="@Url.Content(Model.ImageUrl)" alt="@Model.Name" class="img-fluid rounded shadow-lg" style="max-height: 450px; object-fit: cover;">
        </div>

        <div class="col-md-6 product-info-column">
            <div class="product-details-content">
                <h2 class="mb-3">@Model.Name</h2>
                <p class="text-muted lead">@Model.Description</p>
                <div class="additional-info mt-4">
                    @if (!string.IsNullOrEmpty(Model.Benefits))
                    {
                        <h5><i class="fas fa-leaf me-2 text-success"></i>Benefits</h5> <p>@Model.Benefits</p>
                    }
                    @if (!string.IsNullOrEmpty(Model.HowToUse))
                    {
                        <h5 class="mt-4"><i class="fas fa-book-open me-2 text-info"></i>How to Use</h5> <p>@Model.HowToUse</p>
                    }
                    @if (!string.IsNullOrEmpty(Model.Ingredients))
                    {
                        <h5 class="mt-4"><i class="fas fa-flask me-2 text-primary"></i>Key Ingredients</h5> <p>@Model.Ingredients</p>
                    }
                </div>
            </div>
            <div class="product-purchase-section">
                <h3 class="text-danger my-3">$@Model.Price.ToString("F2")</h3>
                <form asp-controller="Cart" asp-action="Add" method="post" class="mt-auto">
                    <input type="hidden" name="productId" value="@Model.Id" />
                    <button type="submit" class="btn btn-app-theme btn-lg w-100 py-2">Add to Bag 🛍️</button>
                </form>
            </div>
        </div>
    </div>

    <hr />

    <!-- === قسم مراجعات العملاء (بدون تغيير) === -->
    <!-- === ✅✅✅ قسم مراجعات العملاء (الكود الكامل) ✅✅✅ === -->
    <div class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Customer Reviews</h3>
            <button class="btn btn-outline-app-theme" data-bs-toggle="modal" data-bs-target="#addReviewModal">
                <i class="fas fa-plus me-1"></i> Add Review
            </button>
        </div>
        <div class="p-4 border rounded" id="reviewsContainer">
            <!-- مراجعة كمثال (لاحقًا ستأتي من قاعدة البيانات) -->
            <div class="d-flex align-items-start mb-3">
                <img src="https://i.pravatar.cc/60?img=1" class="rounded-circle me-3" alt="User" />
                <div>
                    <h6 class="mb-1">Sara Ahmed</h6>
                    <div class="star-rating mb-2">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                    </div>
                    <p class="mb-0">The product is amazing, smells so good and makes my hair soft!</p>
                </div>
            </div>
            <!-- يمكنك إضافة المزيد من المراجعات الثابتة هنا بنفس الطريقة -->
        </div>
    </div>
</div>

<!-- === ✅✅✅ نافذة إضافة مراجعة (الكود الكامل ) ✅✅✅ === -->
<div class="modal fade" id="addReviewModal" tabindex="-1" aria-labelledby="addReviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addReviewModalLabel">Add a New Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="reviewForm">
                    <div class="mb-3">
                        <label class="form-label">Your Rating</label>
                        <div class="rating-input" data-rating="0">
                            <i class="fa-solid fa-star" data-value="1"></i><i class="fa-solid fa-star" data-value="2"></i><i class="fa-solid fa-star" data-value="3"></i><i class="fa-solid fa-star" data-value="4"></i><i class="fa-solid fa-star" data-value="5"></i>
                        </div>
                        <input type="hidden" id="ratingValue" value="0" />
                    </div>
                    <div class="mb-3">
                        <label for="reviewerName" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="reviewerName" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-3">
                        <label for="reviewText" class="form-label">Your Review</label>
                        <textarea class="form-control" id="reviewText" rows="3" placeholder="What did you think of the product?" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-app-theme" id="submitReviewBtn">Submit Review</button>
            </div>
        </div>
    </div>
</div>
<!-- === ✅ قسم "منتجات قد تعجبك أيضًا" ببيانات حقيقية === -->
<div class="mt-5 pt-4">
    <h2 class="text-center mb-4">You Might Also Like</h2>
    <div class="row">
        <!-- المنتج الحقيقي الأول -->
        <div class="col-md-3 mb-4">
            <div class="card h-100 border-0 shadow-sm related-product-card">
                <a href="#">
                    <!-- ✅ التعديل الثاني هنا -->
                    <img src="@Url.Content("~/Images/qFjXL2a7XZMKxnOUQQBD4poWSFpAmT3aMz5C2fFY.webp")" class="card-img-top" alt="Eva Skin Clinic Hyaluronic Acid Serum" style="height: 200px; object-fit: cover;">
                </a>
                <div class="card-body text-center d-flex flex-column">
                    <h6 class="card-title flex-grow-1"><a href="#" class="text-dark text-decoration-none">Eva Skin Clinic Hyaluronic Acid Serum</a></h6>
                    <p class="text-danger fw-bold">EGP 250.00</p>
                </div>
            </div>
        </div>
        <!-- المنتج الحقيقي الثاني -->
        <div class="col-md-3 mb-4">
            <div class="card h-100 border-0 shadow-sm related-product-card">
                <a href="#">
                    <!-- ✅ التعديل الثالث هنا -->
                    <img src="@Url.Content("~/Images/WYHwbVaQjYAIIweaD4cgpEEQVXysgUfNefU5pEoF.webp")" class="card-img-top" alt="Eva Skin Clinic Vitamin C Serum" style="height: 200px; object-fit: cover;">
                </a>
                <div class="card-body text-center d-flex flex-column">
                    <h6 class="card-title flex-grow-1"><a href="#" class="text-dark text-decoration-none">Eva Skin Clinic Vitamin C Serum</a></h6>
                    <p class="text-danger fw-bold">EGP 240.00</p>
                </div>
            </div>
        </div>
        <!-- المنتج الحقيقي الثالث -->
        <div class="col-md-3 mb-4">
            <div class="card h-100 border-0 shadow-sm related-product-card">
                <a href="#">
                    <!-- ✅ التعديل الرابع هنا -->
                    <img src="@Url.Content("~/Images/N5xsfubt6kGRCm0nmcAExExzG9xa8B3BaJW3oO2B.webp")" class="card-img-top" alt="Eva Skin Clinic Collagen Day Cream" style="height: 200px; object-fit: cover;">
                </a>
                <div class="card-body text-center d-flex flex-column">
                    <h6 class="card-title flex-grow-1"><a href="#" class="text-dark text-decoration-none">Eva Skin Clinic Collagen Day Cream</a></h6>
                    <p class="text-danger fw-bold">EGP 210.00</p>
                </div>
            </div>
        </div>
        <!-- المنتج الحقيقي الرابع -->
        <div class="col-md-3 mb-4">
            <div class="card h-100 border-0 shadow-sm related-product-card">
                <a href="#">
                    <!-- ✅ التعديل الخامس هنا -->
                    <img src="@Url.Content("~/Images/14zPX4CNFbVHMPXfLPoFAfD3A9cNzc7Lleigew4m.webp")" class="card-img-top" alt="Eva Man Look Hair Cream" style="height: 200px; object-fit: cover;">
                </a>
                <div class="card-body text-center d-flex flex-column">
                    <h6 class="card-title flex-grow-1"><a href="#" class="text-dark text-decoration-none">Eva Man Look Hair Cream</a></h6>
                    <p class="text-danger fw-bold">EGP 85.00</p>
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        // --- JavaScript for Star Rating Interaction ---
        const stars = document.querySelectorAll('.rating-input .fa-star');
        const ratingInputContainer = document.querySelector('.rating-input');
        const ratingValueInput = document.getElementById('ratingValue');
        stars.forEach(star => {
            star.addEventListener('mouseover', function () {
                resetStars();
                const rating = this.dataset.value;
                for (let i = 0; i < rating; i++) { stars[i].classList.add('selected'); }
            });
            star.addEventListener('click', function () {
                const rating = this.dataset.value;
                ratingValueInput.value = rating;
                ratingInputContainer.dataset.rating = rating;
            });
        });
        ratingInputContainer.addEventListener('mouseout', function () {
            resetStars();
            const currentRating = ratingValueInput.value;
            for (let i = 0; i < currentRating; i++) { stars[i].classList.add('selected'); }
        });
        function resetStars() { stars.forEach(s => s.classList.remove('selected')); }

        // --- JavaScript for Submitting the Review (Client-Side) ---
        document.getElementById('submitReviewBtn').addEventListener('click', function () {
            const name = document.getElementById('reviewerName').value;
            const text = document.getElementById('reviewText').value;
            const rating = parseInt(ratingValueInput.value);
            if (!name || !text || rating === 0) {
                alert('Please fill out all fields and select a rating.');
                return;
            }
            let starsHTML = '';
            for (let i = 0; i < 5; i++) {
                const starClass = i < rating ? 'fas fa-star star-rating' : 'far fa-star';
                starsHTML += `<i class="${starClass}"></i>`;
            }
            const reviewElement = document.createElement('div');
            reviewElement.className = 'd-flex align-items-start mb-3';
            reviewElement.innerHTML = `
                        <img src="https://i.pravatar.cc/60?img=${Math.floor(Math.random() * 10) + 2}" class="rounded-circle me-3" alt="User" />
                        <div>
                            <h6 class="mb-1">${name}</h6>
                            <div class="mb-2">${starsHTML}</div>
                            <p class="mb-0">${text}</p>
                        </div>
                    `;
            document.getElementById('reviewsContainer').prepend(reviewElement);
            var modal = bootstrap.Modal.getInstance(document.getElementById('addReviewModal'));
            modal.hide();
            document.getElementById('reviewForm').reset();
            ratingValueInput.value = 0;
            resetStars();
        });
    </script>
}
